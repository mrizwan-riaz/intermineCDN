(function(){var e,t,n,r,i,s,o,u,a;e=typeof exports!="undefined",e?r=exports:(i=(u=this.intermine)!=null?u:this.intermine={},r=(a=i.imjs)!=null?a:i.imjs={}),r.VERSION="unknown",e?(n=require("fs"),s=require("path"),process.mainModule!=null&&(t=n.readFileSync(s.join(__dirname,"..","package.json"),"utf8"),o=JSON.parse(t),r.VERSION=o.version)):r.VERSION="2.6.0"}).call(this),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p;n=typeof exports!="undefined",e=typeof console!="undefined",t=typeof JSON!="undefined",r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];if(!n){t||jQuery.getScript("http://cdn.intermine.org/js/json3/3.2.2/json3.min.js"),Object.keys==null&&(s=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),Object.keys=function(e){var t,n,o,u,a;if(typeof e!="object"&&typeof e!=""||e===null)throw new TypeError("Object.keys called on a non-object");t=function(){var t;t=[];for(n in e)s.call(e,n)&&t.push(n);return t}();if(i)for(u=0,a=r.length;u<a;u++)o=r[u],s.call(e,o)&&t.push(o);return t}),Array.prototype.map==null&&(Array.prototype.map=function(e){var t,n,r,i;i=[];for(n=0,r=this.length;n<r;n++)t=this[n],i.push(e(t));return i}),Array.prototype.filter==null&&(Array.prototype.filter=function(e){var t,n,r,i;i=[];for(n=0,r=this.length;n<r;n++)t=this[n],e(t)&&i.push(t);return i}),Array.prototype.reduce==null&&(Array.prototype.reduce=function(e,t){var n,r,i,s,o;i=this.slice(),n=arguments.length<2?i.pop():t;for(s=0,o=i.length;s<o;s++)r=i[s],n=e(n,r);return n}),Array.prototype.forEach==null&&(Array.prototype.forEach=function(e,t){var n,r,i,s,o;if(!e)throw new Error("No function provided");o=[];for(n=i=0,s=this.length;i<s;n=++i)r=this[n],o.push(e.call(t!=null?t:this,r,n,this));return o}),e||(this.console={log:function(){},error:function(){},debug:function(){}},typeof window!="undefined"&&window!==null&&(window.console=this.console)),(l=console.log)==null&&(console.log=function(){}),(c=console.error)==null&&(console.error=function(){}),(h=console.debug)==null&&(console.debug=function(){});if(console.log.apply==null){console.log("Your console needs patching."),p=["log","error","debug"],u=function(e){var t;return t=console[e],console[e]=function(e){return t(e)}};for(a=0,f=p.length;a<f;a++)o=p[a],u(o)}}}.call(this),function(e,t){var n=e._,r=e.jQuery;if(typeof r=="undefined")return null;var i=r;if(!i.support.cors&&window.XDomainRequest){console.log("Patching IE x-domain request support");var s=/^https?:\/\//i,o=/^get|post$/i,u=new RegExp("^"+location.protocol,"i"),a=/\/json/i,f=/\/xml/i,l=function(e,t){this.userOptions=e,this.options=t,this.userType=(e.dataType||"").toLowerCase(),n.bindAll(this)};l.prototype.constructor=l,l.prototype.send=function(e,t){this.xdr=new XDomainRequest,this.complete=t;var n=this.xdr;/^\d+$/.test(this.userOptions.timeout)&&(n.timeout=this.userOptions.timeout),n.ontimeout=function(){t(500,"timeout")},n.onerror=function(){t(500,"error",{text:n.responseText})},n.onload=this.onLoad;var r=this.userOptions.data&&i.param(this.userOptions.data)||"";n.open(this.options.type,this.options.url),n.send(r)},l.prototype.respond=function(e,t,n,i){var s=this.xdr;s.onload=s.onerror=s.ontimeout=s.onprogress=r.noop,delete this.xdr,r.event.trigger("ajaxStop"),this.complete(e,t,n,i)},l.prototype.abort=function(){xdr&&xdr.abort()},l.prototype.onLoad=function(){var e=this.xdr,n="Content-Length: "+e.responseText.length+"\r\nContent-Type: "+e.contentType,r={code:200,message:"success"},s={text:e.responseText};try{if(this.userType==="json"||this.userType!=="text"&&a.test(e.contentType))try{s.json=i.parseJSON(e.responseText)}catch(o){r.code=500,r.message="parseerror"}else if(this.userType==="xml"||this.userType!=="text"&&f.test(e.contentType)){var u=new ActiveXObject("Microsoft.XMLDOM");u.async=!1;try{u.loadXML(e.responseText)}catch(o){u=t}if(!u||!u.documentElement||u.getElementsByTagName("parsererror").length)throw r.code=500,r.message="parseerror","Invalid XML: "+e.responseText;s.xml=u}}catch(l){throw l}finally{this.complete(r.code,r.message,s,n)}},r.ajaxTransport("text html xml json",function(e,t,n){if(e.crossDomain&&e.async&&o.test(e.type)&&s.test(t.url)&&u.test(t.url))return new l(t,e)}),r.support.cors=!0}}.call(this,typeof exports=="undefined"?this:exports),function(){var e,t,n,r,i;e=typeof exports!="undefined",e?t=exports:(n=(r=this.intermine)!=null?r:this.intermine={},t=(i=n.constants)!=null?i:n.constants={}),t.ACCEPT_HEADER={json:"application/json",jsonobjects:"application/json;type=objects",jsontable:"application/json;type=table",jsonrows:"application/json;type=rows",jsoncount:"application/json;type=count",jsonp:"application/javascript",jsonpobjects:"application/javascript;type=objects",jsonptable:"application/javascript;type=table",jsonprows:"application/javascript;type=rows",jsonpcount:"application/javascript;type=count"}}.call(this),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d=[].slice,v={}.hasOwnProperty;t=typeof exports!="undefined",u=typeof exports!="undefined"&&exports!==null?exports:this,t?(e=require("underscore.deferred").Deferred,l=require("underscore")._):(e=u.jQuery.Deferred,l=u._,(h=u.intermine)==null&&(u.intermine={}),(p=(c=u.intermine).funcutils)==null&&(c.funcutils={}),u=u.intermine.funcutils),u.curry=r=function(){var e,t;return t=arguments[0],e=2<=arguments.length?d.call(arguments,1):[],function(){var n;return n=1<=arguments.length?d.call(arguments,0):[],t.apply(null,e.concat(n))}},u.error=function(t){return e(function(){return this.reject(new Error(t))}).promise()},u.success=a=function(){var t;return t=1<=arguments.length?d.call(arguments,0):[],e(function(){return this.resolve.apply(this,t)}).promise()},u.fold=i=function(e){return function(t,n){var r,i,s;if(n.reduce!=null)return n.reduce(e,t);i=t;for(r in n)s=n[r],i=i!=null?e(i,r,s):{k:s};return i}},u.take=function(e){return function(t){return e!=null?t.slice(0,e-1+1||9e9):t}},u.filter=function(e){return function(t){var n,r,i,s;s=[];for(r=0,i=t.length;r<i;r++)n=t[r],e(n)&&s.push(n);return s}},u.omap=function(e){var t;return t=i(function(t,n,r){var i,s,o;return o=e(n,r),i=o[0],s=o[1],t[i]=s,t}),function(e){return t({},e)}},u.copy=u.omap(function(e,t){return[e,t]}),u.partition=function(e){return function(t){var n,r,i,s,o;r=[],n=[];for(s=0,o=t.length;s<o;s++)i=t[s],e(i)?r.push(i):n.push(i);return[r,n]}},u.id=s=function(e){return e},u.concatMap=function(e){return function(t){var n,r,i,s,o,u,a;i=void 0;for(u=0,a=t.length;u<a;u++)o=t[u],n=e(o),i=function(){var e;if(i===void 0)return n;if((e=typeof n)==="string"||e==="number")return i+n;if(n.slice!=null)return i.concat(n);for(r in n)s=n[r],i[r]=s;return i}();return i}},u.flatMap=u.concatMap,u.sum=u.concatMap(s),u.AND=function(e,t){return e&&t},u.OR=function(e,t){return e||t},u.NOT=function(e){return!e},u.any=function(e,t){var n,r,i;t==null&&(t=s);for(r=0,i=e.length;r<i;r++){n=e[r];if(t(n))return!0}return!1},u.invoke=function(){var t,n;return n=arguments[0],t=2<=arguments.length?d.call(arguments,1):[],function(r){var i;return((i=r[n])!=null?i.apply:void 0)?r[n].apply(r,t):e().reject("No method: "+n).promise()}},u.invokeWith=function(e,t,n){return t==null&&(t=[]),n==null&&(n=null),function(r){return r[e].apply(n||r,t)}},u.get=function(e){return function(t){return t[e]}},u.set=function(e,t){return function(n){var r,i;if(arguments.length===2)n[e]=t;else for(r in e){if(!v.call(e,r))continue;i=e[r],n[r]=i}return n}},u.flip=function(e){return function(){var t;return t=1<=arguments.length?d.call(arguments,0):[],e.apply(null,t.reverse())}},n=function(e,t){return"This service requires a service at version "+e+" or above. This one is at "+t},u.REQUIRES_VERSION=function(e,t,r){return e.fetchVersion().pipe(function(e){return e>=t?r():error(n(t,e))})},u.dejoin=function(e){var t,n,r,i,s;s=e.views;for(r=0,i=s.length;r<i;r++)n=s[r],t=n.split("."),t.length>2&&e.addJoin(t.slice(1,-1).join("."));return e},f=i(function(e,t){return e.then(t)}),u.sequence=function(){var e;return e=1<=arguments.length?d.call(arguments,0):[],f(a(),l.flatten(e))},o=i(function(e,t){var n,r;n=t[0],r=t[1];if(e[n]!=null)throw new Error("Duplicate key: "+n);return e[n]=r,e}),u.pairsToObj=function(e){return o({},e)}}.call(this),function(){var e,t,n,r,i,s,o=[].slice;e=typeof exports!="undefined",i=typeof exports!="undefined"&&exports!==null?exports:this,e?r=i:(r=i.intermine,r==null&&(r=i.intermine={})),(s=r.compression)==null&&(r.compression={}),n=function(e){var t,n,r;t={};for(n=r=0;0<=e?r<=e:r>=e;n=0<=e?++r:--r)t[String.fromCharCode(n)]=n;return t},t=function(e){var t,n,r;r=[];for(t=n=0;0<=e?n<=e:n>=e;t=0<=e?++n:--n)r.push(String.fromCharCode(t));return r},r.compression.LZW={encode:function(e){var t,r,i,s,o,u,a,f,l;i=(e+"").split(""),u=[],a="",o=256,s=n(o);for(f=0,l=i.length;f<l;f++)t=i[f],r=a+t,r in s?a=r:(u.push(s[a]),s[r]=o++,a=String(t));return a!==""&&u.push(s[a]),u},decode:function(e){var n,r,i,s,u,a,f,l,c,h;i=256,r=t(i),s="",u=e[0],f=2<=e.length?o.call(e,1):[],l=String.fromCharCode(u),a=[l];for(c=0,h=f.length;c<h;c++)n=f[c],s=function(){if(r[n])return r[n];if(n===i)return l+l.charAt(0);throw new Error("Key is "+n)}(),a.push(s),r[i++]=l+s.charAt(0),l=s;return a.join("")}}}.call(this),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d;f=this.jQuery,h=this._,a=this.intermine,r=this.XDomainRequest,o=(p=a.http)!=null?p:a.http={},e=a.constants.ACCEPT_HEADER,d=a.funcutils,s=d.get,i=d.error,function(){var t,n,r;t={};for(n in e)r=e[n],t["text "+n]=f.parseJSON;return f.ajaxSetup({accepts:e,contents:{json:/json/},converters:t})}(),t=function(e){return f.Deferred(function(){return e.wasSuccessful?this.resolve(e):this.reject(e.error,e)})},n=function(e,t,n){try{return JSON.parse(e.responseText).error}catch(n){return t}},u=r!=null,l={PUT:"POST",DELETE:"GET"},u?(o.getMethod=function(e){var t;return(t=l[e])!=null?t:e},o.supports=function(e){return!(e in l)}):(o.getMethod=function(e){return e},o.supports=function(){return!0}),c=function(e){var t,n,r,i;return h.isArray(e)?e.length?(n=e[0],r=e[1],t=e[2],i=function(e){return h.each(e,n!=null?n:function(){})},[i,r,t]):[]:(i=function(t){return h.each(t,e!=null?e:function(){})},[i])},o.iterReq=function(e,t,n){return function(r,i,o,u,a){var f,l,c;return i==null&&(i={}),o==null&&(o=function(){}),u==null&&(u=function(){}),a==null&&(a=function(){}),arguments.length===2&&h.isFunction(i)&&(c=[i,{}],o=c[0],i=c[1]),f=h.extend({format:n},i,{query:r.toXML()}),l=function(e){return e.forEach(o)},this.makeRequest(e,t,f).fail(u).pipe(s("results")).done(o).done(a)}},o.doReq=function(e){var r;return r=e.error||this.errorHandler,e.error=h.compose(r,n),f.ajax(e).pipe(t).fail(r)}}.call(this),function(){var e,t,n,r,i,s,o,u;t=typeof exports!="undefined",t?(e=require("xmldom").DOMParser,o=exports,n=new e,s=function(e){var t;if(e!=null?!e.match("<.*>"):!void 0)e+=">";try{e&&(t=n.parseFromString(e,"text/xml"))}catch(r){t=void 0}if(!t||!t.documentElement||t.getElementsByTagName("parsererror").length)throw new Error("Invalid xml: "+e);return t}):(i=this.jQuery,r=this.intermine,o=(u=r.xml)!=null?u:r.xml={},s=i.parseXML),o.parse=s}.call(this),function(){var e,t,n,r,i,s;e=typeof exports!="undefined",i=typeof exports!="undefined"&&exports!==null?exports:(s=this.intermine)!=null?s:this.intermine={},n=function(e,t){var n,r,i;i=[];for(n in e)r=e[n],i.push(t[n]=r);return i},r=["attributes","references","collections"],t=function(){function e(e){var t,i,s,o,u,a;this.name=e.name,this.attributes=e.attributes,this.references=e.references,this.collections=e.collections,this.fields={},this.__parents__=arguments[0]["extends"];for(o=0,u=r.length;o<u;o++)i=r[o],n(this[i],this.fields);a=this.collections;for(s in a)t=a[s],t.isCollection=!0}return e.prototype.toString=function(){var e,t;return"[Table name="+this.name+", fields=["+function(){var n,r;n=this.fields,r=[];for(e in n)t=n[e],r.push(e);return r}.call(this)+"]]"},e.prototype.parents=function(){var e;return((e=this.__parents__)!=null?e:[]).slice()},e}(),i.Table=t}.call(this),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y=function(e,t){return function(){return e.apply(t,arguments)}},b=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};n=typeof exports!="undefined",g=typeof exports!="undefined"&&exports!==null?exports:this,n?(c=g,m=require("underscore")._,t=(e=require("underscore.deferred")).Deferred,v=require("./util")):(m=g._,t=(e=g.jQuery).Deferred,c=g.intermine,v=c.funcutils),u=v.concatMap,l=v.get,o=v.any,p=v.set,a=v.copy,d=v.success,f=v.error,r={},i={},h=function(e,t,n){var r,i,s;return""+(e!=null?e.name:void 0)+"|"+(e!=null?(s=e.service)!=null?s.root:void 0:void 0)+"|"+t+":"+function(){var e;e=[];for(r in n)i=n[r],e.push(""+r+"="+i);return e}()},s=function(){function e(e){var t;this.root=e.root,this.model=e.model,this.descriptors=e.descriptors,this.subclasses=e.subclasses,this.displayName=e.displayName,this.ident=e.ident,this.allDescriptors=y(this.allDescriptors,this),this.getChildNodes=y(this.getChildNodes,this),this.getDisplayName=y(this.getDisplayName,this),this.isa=y(this.isa,this),this.append=y(this.append,this),this.getParent=y(this.getParent,this),this.getEndClass=y(this.getEndClass,this),this.containsCollection=y(this.containsCollection,this),this.isCollection=y(this.isCollection,this),this.isReference=y(this.isReference,this),this.isClass=y(this.isClass,this),this.isAttribute=y(this.isAttribute,this),this.isRoot=y(this.isRoot,this),this.end=m.last(this.descriptors),(t=this.ident)==null&&(this.ident=h(this.model,this,this.subclasses))}return e.prototype.isRoot=function(){return this.descriptors.length===0},e.prototype.isAttribute=function(){return this.end!=null&&this.end.referencedType==null},e.prototype.isClass=function(){return this.isRoot()||this.end.referencedType!=null},e.prototype.isReference=function(){var e;return((e=this.end)!=null?e.referencedType:void 0)!=null},e.prototype.isCollection=function(){var e,t;return(e=(t=this.end)!=null?t.isCollection:void 0)!=null?e:!1},e.prototype.containsCollection=function(){return o(this.descriptors,function(e){return e.isCollection})},e.prototype.getEndClass=function(){var e;return this.model.classes[this.subclasses[this.toString()]||((e=this.end)!=null?e.referencedType:void 0)]||this.root},e.prototype.getParent=function(){var t;if(this.isRoot())throw new Error("Root paths do not have parents");return t={root:this.root,model:this.model,descriptors:m.initial(this.descriptors),subclasses:this.subclasses},new e(t)},e.prototype.append=function(t){var n,r;if(this.isAttribute())throw new Error(""+this+" is an attribute.");r=m.isString(t)?this.getType().fields[t]:t;if(r==null)throw new Error(""+t+" is not a field of "+this.getType());return n={root:this.root,model:this.model,descriptors:this.descriptors.concat(r),subclasses:this.subclasses},new e(n)},e.prototype.isa=function(e){var t,n;return this.isAttribute()?this.getType()===e:(t=e.name?e.name:""+e,n=this.getType(),t===n.name||b.call(this.model.getAncestorsOf(n),t)>=0)},e.prototype.getDisplayName=function(e){var t,n,i,s,o,c=this;return(n=this.displayName)?d(n):((o=this.namePromise)==null&&(this.namePromise=(t=r[this.ident])?d(t):this.model.service==null?f("No service"):(s="model"+u(function(e){return"/"+e.name})(this.allDescriptors()),i=p({format:"json"})(a(this.subclasses)),this.model.service.get(s,i).then(l("display")).done(function(e){var t,n;return(n=r[t=c.ident])!=null?n:r[t]=e}))),this.namePromise.done(e))},e.prototype.getChildNodes=function(){var e,t,n,r,i;r=((n=this.getEndClass())!=null?n.fields:void 0)||{},i=[];for(t in r)e=r[t],i.push(this.append(e));return i},e.prototype.allDescriptors=function(){return[this.root].concat(this.descriptors)},e.prototype.toString=function(){return this.allDescriptors().map(l("name")).join(".")},e.prototype.equals=function(e){return e&&e.ident!=null&&this.ident===e.ident},e.prototype.getType=function(){var e,t;return((e=this.end)!=null?(t=e.type)!=null?t.replace(/java\.lang\./,""):void 0:void 0)||this.getEndClass()},e}(),s.prototype.toPathString=s.prototype.toString,s.parse=function(e,t,n){var r,o,u,a,f,l,c,p,d;return n==null&&(n={}),f=h(e,t,n),(r=i[f])?r:(p=(t+"").split("."),d=o=e.classes[p.shift()],l=d.name,u=function(){var r,i,s,u;u=[];for(r=0,i=p.length;r<i;r++){c=p[r],a=(o!=null?o.fields[c]:void 0)||((s=o=e.classes[n[l]])!=null?s.fields[c]:void 0);if(!a)throw new Error("Could not find "+c+" in "+o+" when parsing "+t);l+="."+c,o=e.classes[a.type||a.referencedType],u.push(a)}return u}(),i[f]=new s({root:d,model:e,descriptors:u,subclasses:n,ident:f}))},s.flushCache=function(){return i={},r={}},c.PathInfo=s}.call(this),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d=function(e,t){return function(){return e.apply(t,arguments)}},v=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};n=typeof exports!="undefined",h=typeof exports!="undefined"&&exports!==null?exports:this,n?(u=h,c=require("underscore")._,t=(e=require("underscore.deferred")).Deferred,s=require("./table").Table,i=require("./path").PathInfo,l=require("./util").omap):(c=h._,t=(e=h.jQuery).Deferred,u=(p=h.intermine)!=null?p:h.intermine={},s=u.Table,i=u.PathInfo,l=u.funcutils.omap),o=c.flatten,a=c.intersection,f=l(function(e,t){return[e,new s(t)]}),r=function(){function e(e){var t;this.name=e.name,t=e.classes,this.findCommonType=d(this.findCommonType,this),this.findSharedAncestor=d(this.findSharedAncestor,this),this.getAncestorsOf=d(this.getAncestorsOf,this),this.getSubclassesOf=d(this.getSubclassesOf,this),this.getPathInfo=d(this.getPathInfo,this),this.classes=f(t)}return e.prototype.getPathInfo=function(e,t){return i.parse(this,e,t)},e.prototype.getSubclassesOf=function(e){var t,n,r,i,s;n=e&&e.name?e:this.classes[e];if(n==null)throw new Error(""+e+" is not a table");r=[n.name],i=this.classes;for(c in i){t=i[c];if(s=n.name,v.call(t.parents(),s)>=0)r=r.concat(this.getSubclassesOf(t))}return r},e.prototype.getAncestorsOf=function(e){var t,n,r,i,s;n=e&&e.name?e:this.classes[e];if(n==null)throw new Error(""+e+" is not a table");t=n.parents();for(i=0,s=t.length;i<s;i++)r=t[i],t.push(this.getAncestorsOf(r));return o(t)},e.prototype.findSharedAncestor=function(e,t){var n,r,i;return t===null||e===null?null:e===t?e:(n=this.getAncestorsOf(e),v.call(n,t)>=0?t:(r=this.getAncestorsOf(t),v.call(r,e)>=0?e:(i=a(n,r).shift())!=null?i:null))},e.prototype.findCommonType=function(e){return e==null&&(e=[]),e.reduce(this.findSharedAncestor)},e}(),r.prototype.makePath=r.prototype.getPathInfo,r.prototype.findCommonTypeOfMultipleClasses=r.prototype.findCommonType,r.load=function(e){return new r(e)},r.INTEGRAL_TYPES=["int","Integer","long","Long"],r.FRACTIONAL_TYPES=["double","Double","float","Float"],r.NUMERIC_TYPES=r.INTEGRAL_TYPES.concat(r.FRACTIONAL_TYPES),r.BOOLEAN_TYPES=["boolean","Boolean"],u.Model=r}.call(this),function(){var e,t,n,r,i,s,o,u,a=function(e,t){return function(){return e.apply(t,arguments)}};t=typeof exports!="undefined",u=typeof exports!="undefined"&&exports!==null?exports:this,t?(e=require("underscore.deferred").Deferred,o=require("underscore")._,i=require("./util").error,s=u):(o=u._,e=u.jQuery.Deferred,s=u.intermine,i=s.funcutils.error),r=function(e,t,n){return e.service.manageUserPreferences(n,t).done(function(t){return e.preferences=t})},n=function(){function e(e,t){var n;this.service=e,this.username=t.username,this.preferences=t.preferences,this.refresh=a(this.refresh,this),this.clearPreferences=a(this.clearPreferences,this),this.clearPreference=a(this.clearPreference,this),this.setPreferences=a(this.setPreferences,this),this.setPreference=a(this.setPreference,this),this.hasPreferences=this.preferences!=null,(n=this.preferences)==null&&(this.preferences={})}return e.prototype.setPreference=function(e,t){var n;return o.isString(e)?(n={},n[e]=t):t==null?n=e:i("Incorrect arguments to setPreference"),this.setPreferences(n)},e.prototype.setPreferences=function(e){return r(this,e,"POST")},e.prototype.clearPreference=function(e){return r(this,{key:e},"DELETE")},e.prototype.clearPreferences=function(){return r(this,{},"DELETE")},e.prototype.refresh=function(){return r(this,{},"GET")},e}(),s.User=n}.call(this),function(){var e,t,n,r,i,o,u,a,f,l,c,h,p,d,v,m,g=function(e,t){return function(){return e.apply(t,arguments)}},y={}.hasOwnProperty,b=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};t=typeof exports!="undefined",m=typeof exports!="undefined"&&exports!==null?exports:this,t?(v=require("underscore")._,a=require("./util"),c=m):(v=m._,c=m.intermine,a=c.funcutils),f=a.get,h=a.invoke,r=a.REQUIRES_VERSION,d=a.set,u=a.dejoin,o="list/tags",i="lists/shares",e="lists/invitations",p=function(e){return e.substr(0,e.indexOf(":"))==="__folder__"},l=function(e){return s.substr(e.indexOf(":")+1)},n=function(){function t(e,t){var n,r;this.service=t,this.hasTag=g(this.hasTag,this);for(n in e){if(!y.call(e,n))continue;r=e[n],this[n]=r}this.dateCreated=this.dateCreated!=null?new Date(this.dateCreated):null,this.folders=this.tags.filter(p).map(l)}return t.prototype.hasTag=function(e){return b.call(this.tags,e)>=0},t.prototype.query=function(e){return e==null&&(e=["*"]),this.service.query({select:e,from:this.type,where:[[this.type,"IN",this.name]]})},t.prototype.del=function(e){return this.service.makeRequest("DELETE","lists",{name:this.name},e)},t.prototype.fetchTags=function(e){var t=this;return this.service.makeRequest("GET","list/tags",{name:this.name}).pipe(function(e){return e.tags}).done(function(e){return t.tags=e,t.folders.filter(p).map(l)}).done(e)},t.prototype.addTags=function(e,t){var n=this;return this.service.makeRequest("POST","list/tags",{name:this.name,tags:e}).pipe(function(e){return e.tags}).done(function(e){return n.tags=e,n.folders.filter(p).map(l)}).done(t)},t.prototype.removeTags=function(e,t){var n=this;return this.service.makeRequest("DELETE","list/tags",{name:this.name,tags:e}).pipe(function(e){return e.tags}).done(function(e){return n.tags=e,n.folders.filter(p).map(l)}).done(t)},t.prototype.contents=function(e){return this.query().pipe(u).pipe(h("records")).done(e)},t.prototype.rename=function(e,t){var n=this;return this.service.post("lists/rename",{oldname:this.name,newname:e}).pipe(f("listName")).done(function(e){return n.name=e}).pipe(this.service.fetchList).done(t)},t.prototype.copy=function(e,t){var n,r,i,s,o,u,a,l=this;return e==null&&(e={}),t==null&&(t=function(){}),arguments.length===1&&v.isFunction(e)&&(o=[{},e],e=o[0],t=o[1]),v.isString(e)&&(e={name:""+e}),r=n=(u=e.name)!=null?u:""+this.name+"_copy",s=this.tags.concat((a=e.tags)!=null?a:[]),i=this.query(["id"]),this.service.fetchLists().pipe(h("map",f("name"))).pipe(function(e){var o;o=1;while(b.call(e,r)>=0)r=""+n+"-"+o++;return i.pipe(h("saveAsList",{name:r,tags:s,description:l.description})).done(t)})},t.prototype.enrichment=function(e,t){return this.service.enrichment(d({list:this.name})(e),t)},t.prototype.shareWithUser=function(e,t){return this.service.post(i,{list:this.name,"with":e}).done(t)},t.prototype.inviteUserToShare=function(t,n,r){return n==null&&(n=!0),r==null&&(r=function(){}),this.service.post(e,{list:this.name,to:t,notify:!!n}).done(r)},t}(),c.List=n}.call(this),function(){var e,t,n,r,i,s,o,u=function(e,t){return function(){return e.apply(t,arguments)}};n=typeof exports!="undefined",o=typeof exports!="undefined"&&exports!==null?exports:this,n?(e=require("underscore.deferred").Deferred,r=require("./util"),s=o):(e=o.jQuery.Deferred,s=o.intermine,r=s.funcutils),i=r.get,t=function(){function t(e,t){this.uid=e,this.service=t,this.del=u(this.del,this),this.fetchResults=u(this.fetchResults,this),this.fetchErrorMessage=u(this.fetchErrorMessage,this),this.fetchStatus=u(this.fetchStatus,this)}return t.prototype.fetchStatus=function(e){return this.service.get("ids/"+this.uid+"/status").pipe(i("status")).done(e)},t.prototype.fetchErrorMessage=function(e){return this.service.get("ids/"+this.uid+"/status").pipe(i("message")).done(e)},t.prototype.fetchResults=function(e){return this.service.get("ids/"+this.uid+"/result").pipe(i("results")).done(e)},t.prototype.del=function(e){return this.service.makeRequest("DELETE","ids/"+this.uid,{},e)},t.prototype.poll=function(t,n,r){var i,s,o=this;return s=e().done(t).fail(n).progress(r),i=this.fetchStatus(),i.fail(s.reject),i.done(function(e){s.notify(e);switch(e){case"SUCCESS":return o.fetchResults().then(s.resolve,s.reject);case"ERROR":return o.fetchErrorMessage().then(s.reject,s.reject);default:return o.poll(s.resolve,s.reject,s.notify)}}),s.promise()},t}(),t.create=function(e){return function(n){return new t(n,e)}},s.IDResolutionJob=t}.call(this),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},Z=function(e,t){return function(){return e.apply(t,arguments)}},et=[].slice;i=typeof exports!="undefined",U=typeof exports!="undefined"&&exports!==null?exports:this,i?(N=U,R=require("underscore")._,r=(e=require("underscore.deferred")).Deferred,I=require("querystring").stringify,N.xml=require("./xml"),K=require("./util"),P=K.pairsToObj,y=K.filter,H=K.partition,b=K.fold,F=K.take,p=K.concatMap,x=K.id,w=K.get,L=K.invoke):(R=U._,A=U.jQuery,N=U.intermine,Q=N.funcutils,P=Q.pairsToObj,y=Q.filter,H=Q.partition,b=Q.fold,F=Q.take,p=Q.concatMap,x=Q.id,w=Q.get,L=Q.invoke,r=(e=A).Deferred,I=function(e){return A.param(e,!0)}),E=function(e){var t;t=R.isString(e)?o.OP_DICT[e.toLowerCase()]:null;if(!t)throw new Error("Illegal constraint operator: "+e);return t},t=["path","op","code"],a=t.concat(["value","extraValue"]),u=["rowByRow","eachRow","recordByRecord","eachRecord","records","rows","table","tableRows"],s=function(e){return R.compose(e.fetchList,w("listName"))},n=[null,"A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],v=function(e){return e==null&&(e=""),e.substr(e.indexOf("."))},h=function(e){return e!=null?"<value>"+R.escape(e)+"</value>":"<nullValue/>"},f=function(e,t){var n,r;return function(){var i;i=[];for(n in e)r=e[n],Y.call(t,n)>=0&&i.push(""+n+'="'+R.escape(r)+'" ');return i}().join("")},D=function(e){return"<constraint "+f(e,t)+"/>"},q=function(e){return"<constraint "+f(e,["path","type"])+"/>"},B=function(e){return"<constraint "+f(e,a)+"/>"},M=function(e){return"<constraint "+f(e,t)+">"+p(h)(e.values)+"</constraint>"},T=function(e){return"<constraint "+f(e,t)+'ids="'+e.ids.join(",")+'"/>'},l=function(e){var t;return e.values!=null?M(e):e.ids!=null?T(e):e.op==null?q(e):(t=e.op,Y.call(o.NULL_OPS,t)>=0)?D(e):B(e)},S=function(e){return e.replace(/^[^\.]+\./,"")},d=function(e){var t,n,r,i,s,o,u;return i=e.path,s=e.type,r=e.op,o=e.value,u=e.values,n=e.ids,t=e.code,n=n!=null?n.slice():void 0,u=u!=null?u.slice():void 0,_({path:i,type:s,op:r,value:o,values:u,ids:n,code:t})},c=function(e){var t;return t=d(e),t.path=S(t.path),t},_=function(e){var t,n;for(t in e)n=e[t],n==null&&delete e[t];return e},m=function(e,t){return"Did not remove a single constraint. original = "+e+", reduced = "+t},k=function(e,t){var n,r,i,s,u,a;n={path:e};if(t===null)n.op="IS NULL";else if(R.isArray(t))n.op="ONE OF",n.values=t;else if(R.isString(t)||R.isNumber(t))(a=typeof t.toUpperCase=="function"?t.toUpperCase():void 0,Y.call(o.NULL_OPS,a)>=0)?n.op=t:(n.op="=",n.value=t);else{i=function(){var e;e=[];for(r in t)u=t[r],e.push(r);return e}();if(Y.call(i,"isa")>=0)R.isArray(t.isa)?(n.op=r,n.values=t.isa):n.type=t.isa;else{Y.call(i,"extraValue")>=0&&(n.extraValue=t.extraValue);for(r in t){s=t[r];if(r==="extraValue")continue;n.op=r,R.isArray(s)?n.values=s:n.value=s}}}return n},C=function(e){var t,n,r,i;return e=e.slice(),n={path:e.shift()},e.length===1?(t=e[0],(i=typeof t.toUpperCase=="function"?t.toUpperCase():void 0,Y.call(o.NULL_OPS,i)>=0)?n.op=t:n.type=t):e.length>=2&&(n.op=e[0],r=e[1],R.isArray(r)?n.values=r:n.value=r,e.length===3&&(n.extraValue=e[2])),n},j=function(e){var t,n,r,i,s,o,u;if(e==null)return[];n=e.split(/\s+/),r=function(){var e,t,r;r=[];for(i=e=0,t=n.length/2;0<=t?e<t:e>t;i=0<=t?++e:--e)r.push(i*2);return r}(),u=[];for(s=0,o=r.length;s<o;s++)t=r[s],u.push([n[t],n[t+1]]);return u},o=function(){function g(e,t){this.addConstraint=Z(this.addConstraint,this),this.expandStar=Z(this.expandStar,this),this.adjustPath=Z(this.adjustPath,this),this.select=Z(this.select,this);var n,r,s,o,u,a,f,l,c,h,p,d,v,m=this;R.defaults(this,{constraints:[],views:[],joins:{},constraintLogic:"",sortOrder:""}),e==null&&(e={}),this.displayNames=R.extend({},(a=(f=e.displayNames)!=null?f:e.aliases)!=null?a:{}),l=["name","title","comment","description"];for(r=0,s=l.length;r<s;r++)n=l[r],e[n]!=null&&(this[n]=e[n]);this.service=t!=null?t:{},this.model=(c=e.model)!=null?c:{},this.summaryFields=(h=e.summaryFields)!=null?h:{},this.root=(p=e.root)!=null?p:e.from,this.maxRows=(d=(v=e.size)!=null?v:e.limit)!=null?d:e.maxRows,this.start=(o=(u=e.start)!=null?u:e.offset)!=null?o:0,this.select(e.views||e.view||e.select||[]),this.addConstraints(e.constraints||e.where||[]),this.addJoins(e.joins||e.join||[]),this.orderBy(e.sortOrder||e.orderBy||[]),e.constraintLogic!=null&&(this.constraintLogic=e.constraintLogic),i=function(e,t){var n,r,s;return n=m.getPathInfo(e).getEndClass(),s=[e],r=n&&t>0?R.flatten(R.map(n.fields,function(n){return i(""+e+"."+n.name,t-1)})):[],R.flatten(s.concat(r))}}var e,t,i,o,u,a,f,h;return g.JOIN_STYLES=["INNER","OUTER"],g.BIO_FORMATS=["gff3","fasta","bed"],g.NULL_OPS=["IS NULL","IS NOT NULL"],g.ATTRIBUTE_VALUE_OPS=["=","!=",">",">=","<","<=","CONTAINS","LIKE","NOT LIKE"],g.MULTIVALUE_OPS=["ONE OF","NONE OF"],g.TERNARY_OPS=["LOOKUP"],g.LOOP_OPS=["=","!="],g.LIST_OPS=["IN","NOT IN"],g.OP_DICT={"=":"=","==":"=",eq:"=","!=":"!=",ne:"!=",">":">",gt:">",">=":">=",ge:">=","<":"<",lt:"<","<=":"<=",le:"<=",contains:"CONTAINS",CONTAINS:"CONTAINS",like:"LIKE",LIKE:"LIKE","not like":"NOT LIKE","NOT LIKE":"NOT LIKE",lookup:"LOOKUP","IS NULL":"IS NULL","is null":"IS NULL","IS NOT NULL":"IS NOT NULL","is not null":"IS NOT NULL","ONE OF":"ONE OF","one of":"ONE OF","NONE OF":"NONE OF","none of":"NONE OF","in":"IN","not in":"NOT IN",IN:"IN","NOT IN":"NOT IN",WITHIN:"WITHIN",within:"WITHIN",OVERLAPS:"OVERLAPS",overlaps:"OVERLAPS",ISA:"ISA",isa:"ISA"},i=function(){},g.prototype.on=function(e,t,n){var r,i,s,o,u,a,f;e=e.split(/\s+/),r=(u=this._callbacks)!=null?u:this._callbacks={};while(i=e.shift())s=(a=r[i])!=null?a:r[i]={},o=(f=s.tail)!=null?f:s.tail=s.next={},o.callback=t,o.context=n,s.tail=o.next={};return this},g.prototype.bind=function(){var e;return e=1<=arguments.length?et.call(arguments,0):[],this.on.apply(this,e)},g.prototype.off=function(e,t,n){var r,i,s,o,u,a,f,l,c,h;if(e==null)return this._callbacks={},this;e=e.split(/\s+/),r=(h=this._callbacks)!=null?h:this._callbacks={};for(l=0,c=e.length;l<c;l++){s=e[l];if(t!=null){i=u=r[s]||{},o=u.tail;while((a=i.next)!==o)f=(n==null||a.context===n)&&t===a.callback,f?(i.next=a.next||o,a=i):i=a}else delete r[s]}return this},g.prototype.unbind=function(){var e;return e=1<=arguments.length?et.call(arguments,0):[],this.off.apply(this,e)},g.prototype.once=function(e,t,n){var r,i=this;return r=function(){var s;return s=1<=arguments.length?et.call(arguments,0):[],t.apply(n,s),i.off(e,r)},this.on(e,r)},g.prototype.emit=function(){var e;return e=1<=arguments.length?et.call(arguments,0):[],this.trigger.apply(this,e)},g.prototype.trigger=function(){var e,t,n,r,i,s,o,u;i=arguments[0],o=2<=arguments.length?et.call(arguments,1):[],n=this._callbacks;if(!n)return this;e=n.all,(i=i.split(/\s+/)).push(null);while(r=i.shift()){e&&i.push({next:e.next,tail:e.tail,event:r});if(!(s=n[r]))continue;i.push({next:s.next,tail:s.tail})}while(s=i.pop()){u=s.tail,t=s.event?[s.event].concat(o):o;while((s=s.next)!==u)s.callback.apply(s.context||this,t)}return this},u=["name","view","sortOrder","constraintLogic","title","description","comment"],t=["path","type","op","code","value","ids"],f=function(e,t){var n,r,i,s;s=[];for(r=0,i=t.length;r<i;r++)n=t[r],e.hasAttribute(n)&&s.push([n,e.getAttribute(n)]);return s},o=function(e,t){var n,r,i,s,o;s=e.getElementsByTagName(t),o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(n);return o},h=function(e){return function(t){return t.getAttribute(e)}},g.fromXML=function(e){var n,r,i,s,a,l,c;r=N.xml.parse(e),l=o(r,"query")[0]||o(r,"template")[0];if(!l)throw new Error("no query in xml");return s=h("path"),c=h("style"),a=P(f(l,u)),a.view=a.view.split(/\s+/),a.sortOrder=j(a.sortOrder),a.joins=function(){var e,t,n,r;n=o(l,"join"),r=[];for(e=0,t=n.length;e<t;e++)i=n[e],c(i)==="OUTER"&&r.push(s(i));return r}(),a.constraints=function(){var e,r,i,s;i=o(l,"constraint"),s=[];for(e=0,r=i.length;e<r;e++)n=i[e],s.push(function(e){var n,r,i,s,u;return n=P(f(e,t)),n.ids!=null&&(n.ids=function(){var e,t,r,i;r=n.ids.split(","),i=[];for(e=0,t=r.length;e<t;e++)u=r[e],i.push(parseInt(u,10));return i}()),s=o(e,"value"),s.length&&(n.values=function(){var e,t,n;n=[];for(e=0,t=s.length;e<t;e++)i=s[e],n.push(function(){var e,t,n,s;n=i.childNodes,s=[];for(e=0,t=n.length;e<t;e++)r=n[e],s.push(r.data);return s}().join(""));return n}()),n}(n));return s}(),a},g.prototype.removeFromSelect=function(e){var t,n,r,i;return e=R.isString(e)?[e]:e||[],t=R.compose(this.expandStar,this.adjustPath),e=R.flatten(function(){var n,i,s;s=[];for(n=0,i=e.length;n<i;n++)r=e[n],s.push(t(r));return s}()),this.sortOrder=function(){var t,r,i,s,o;i=this.sortOrder,o=[];for(t=0,r=i.length;t<r;t++)n=i[t],(s=n.path,Y.call(e,s)>=0)||o.push(n);return o}.call(this),this.views=function(){var t,n,r,s;r=this.views,s=[];for(t=0,n=r.length;t<n;t++)i=r[t],Y.call(e,i)>=0||s.push(i);return s}.call(this),this.trigger("remove:view",e),this.trigger("change:views",this.views)},g.prototype.removeConstraint=function(e,t){var n,r,i,s;t==null&&(t=!1),i=this.constraints,r=typeof e=="string"?function(t){return t.code===e}:function(t){var n,r;return t.path===e.path&&t.op===e.op&&t.value===e.value&&t.extraValue===e.extraValue&&e.type===t.type&&((n=t.values)!=null?n.join("%%"):void 0)===((r=e.values)!=null?r.join("%%"):void 0)},s=function(){var e,t,s;s=[];for(e=0,t=i.length;e<t;e++)n=i[e],r(n)||s.push(n);return s}();if(s.length!==i.length-1)throw new Error(m(i,s));this.constraints=s;if(!t)return this.trigger("change:constraints"),this.trigger("removed:constraints",R.difference(i,s))},g.prototype.addToSelect=function(e){var t,n,r,i,s;e=R.isString(e)?[e]:e||[],r=R.flatten([R.map(e,R.compose(this.expandStar,this.adjustPath))]),t=function(){var e,t,i;i=[];for(e=0,t=r.length;e<t;e++)n=r[e],(Y.call(this.views,n)>=0||R.indexOf(r,n)!==R.lastIndexOf(r,n))&&i.push(n);return i}.call(this);if(t.length)throw new Error(""+t+" already in the select list");for(i=0,s=r.length;i<s;i++)n=r[i],this.views.push(n);return this.trigger("add:view change:views",r)},g.prototype.select=function(e){return this.views=[],this.addToSelect(e),this},g.prototype.adjustPath=function(e){return e=e&&e.name?e.name:""+e,this.root!=null?e.match("^"+this.root)||(e=this.root+"."+e):this.root=e.split(".")[0],e},g.prototype.getPossiblePaths=function(e){var t,n,r;return e==null&&(e=3),(n=this._possiblePaths)==null&&(this._possiblePaths={}),(r=(t=this._possiblePaths)[e])!=null?r:t[e]=i(this.root,e)},g.prototype.getPathInfo=function(e){var t,n,r;return t=this.adjustPath(e),n=(r=this.model)!=null?typeof r.getPathInfo=="function"?r.getPathInfo(t,this.getSubclasses()):void 0:void 0,n&&t in this.displayNames&&(n.displayName=this.displayNames[t]),n},g.prototype.makePath=g.prototype.getPathInfo,a=R.compose(P,y(w(1)),L("map",function(e){return[e.path,e.type]})),g.prototype.getSubclasses=function(){return a(this.constraints)},g.prototype.getType=function(e){return this.getPathInfo(e).getType()},g.prototype.getViewNodes=function(){var e,t=this;return e=function(e){return t.getPathInfo(e).getParent()},R.uniq(R.map(this.views,e),!1,function(e){return e.toPathString()})},g.prototype.isInView=function(e){var t,n,r;t=this.getPathInfo(e);if(!t)throw new Error("Invalid path: "+e);return t.isAttribute()?(r=t.toString(),Y.call(this.views,r)>=0):(n=t.toString(),R.any(this.getViewNodes(),function(e){return e.toString()===n}))},g.prototype.isConstrained=function(e,t){var n,r,i=this;t==null&&(t=!1),n=this.getPathInfo(e);if(!n)throw new Error("Invalid path: "+e);return r=function(e){return e.op!=null&&e.path===n.toString()},!n.isAttribute()&&t&&(r=function(e){return e.op!=null&&(e.path===n.toString()||n.equals(i.getPathInfo(e.path).getParent()))}),R.any(this.constraints,r)},g.prototype.canHaveMultipleValues=function(e){return this.getPathInfo(e).containsCollection()},g.prototype.getQueryNodes=function(){var e,t,n=this;return t=this.getViewNodes(),e=R.map(this.constraints,function(e){var t;return t=n.getPathInfo(e.path),t.isAttribute()?t.getParent():t}),R.uniq(t.concat(e),!1,function(e){return e.toPathString()})},g.prototype.isInQuery=function(e){var t,n;return t=this.getPathInfo(e),t?(n=t.toPathString(),R.any(R.union(this.views,R.pluck(this.constraints,"path")),function(e){return e.indexOf(n)===0})):!0},g.prototype.isRelevant=function(e){var t,n,r;return n=this.getPathInfo(e),n.isAttribute()&&(n=n.getParent()),r=n.toString(),t=this.getQueryNodes(),R.any(t,function(e){return e.toPathString()===r})},g.prototype.expandStar=function(e){var t,n,r,i,s;if(/\*$/.test(e)){s=e.substr(0,e.lastIndexOf(".")),n=function(e){return s+e},t=this.getType(s);if(/\.\*$/.test(e)&&t&&this.summaryFields[t.name])return r=R.compose(n,v),function(){var e,n,s,o;s=this.summaryFields[t.name],o=[];for(e=0,n=s.length;e<n;e++)i=s[e],this.hasView(i)||o.push(r(i));return o}.call(this);if(/\.\*\*$/.test(e))return r=R.compose(n,function(e){return"."+e.name}),R.uniq(R.union(this.expandStar(s+".*"),R.map(t.attributes,r)))}return e},g.prototype.isOuterJoin=function(e){return this.joins[this.adjustPath(e)]==="OUTER"},g.prototype.hasView=function(e){return this.views&&R.include(this.views,this.adjustPath(e))},g.prototype.count=function(e){if(this.service.count)return this.service.count(this,e);throw new Error("This query has no service with count functionality attached.")},g.prototype.appendToList=function(e,t){var n,r,i,o;return n=e&&e.name?e.name:""+e,i=this.makeListQuery(),r={listName:n,query:i.toXML()},o=(e!=null?e.name:void 0)?function(t){return e.size=t.size}:function(){},this.service.post("query/append/tolist",r).pipe(s(this.service)).done(t,o)},g.prototype.makeListQuery=function(){var e,t,n,r,i;t=this.clone(),(t.views.length!==1||t.views[0]===null||!t.views[0].match(/\.id$/))&&t.select(["id"]),i=this.getViewNodes();for(n=0,r=i.length;n<r;n++)e=i[n],this.isOuterJoined(e)||!t.isInView(e||t.isConstrained(e))&&e.getEndClass().fields.id!=null&&t.addConstraint([e.append("id"),"IS NOT NULL"]);return t},g.prototype.saveAsList=function(e,t){var n,r;return r=this.makeListQuery(),n=R.clone(e),n.listName=n.listName||n.name,n.query=r.toXML(),e.tags&&(n.tags=e.tags.join(";")),this.service.post("query/tolist",n).pipe(s(this.service)).done(t)},g.prototype.summarise=function(e,t,n){return this.filterSummary(e,"",t,n)},g.prototype.summarize=function(){var e;return e=1<=arguments.length?et.call(arguments,0):[],this.summarise.apply(this,e)},g.prototype.filterSummary=function(e,t,n,i){var s,o,u,a;return i==null&&(i=function(){}),R.isFunction(n)&&(a=[n,null],i=a[0],n=a[1]),e=this.adjustPath(e),u=this.clone(),R.include(u.views,e)||u.views.push(e),o={query:u.toXML(),summaryPath:e,format:"jsonrows"},n&&(o.size=n),t&&(o.filterTerm=t),s=function(e){return r(function(){var t,n,r;return t=e.results.map(function(e){return e.count=parseInt(e.count,10),e}),n={uniqueValues:e.uniqueValues},((r=t[0])!=null?r.max:void 0)!=null&&R.extend(n,t[0]),this.resolve(t,n,e.filteredCount)})},this.service.post("query/results",o).pipe(s).done(i)},g.prototype.clone=function(e){var t;return t=new g(this,this.service),e?t._callbacks=this._callbacks:t._callbacks={},t},g.prototype.next=function(){var e;return e=this.clone(),this.maxRows&&(e.start=this.start+this.maxRows),e},g.prototype.previous=function(){var e;return e=this.clone(),this.maxRows?e.start=this.start-this.maxRows:e.start=0,e},g.prototype.getSortDirection=function(e){var t,n,r,i,s;e=this.adjustPath(e),s=this.sortOrder;for(r=0,i=s.length;r<i;r++)n=s[r],n.path===e&&(t=n.direction);return t},g.prototype.isOuterJoined=function(e){return e=this.adjustPath(e),R.any(this.joins,function(t,n){return t==="OUTER"&&e.indexOf(n)===0})},g.prototype.getOuterJoin=function(e){var t,n=this;return e=this.adjustPath(e),t=R.sortBy(R.keys(this.joins),w("length")).reverse(),R.find(t,function(t){return n.joins[t]==="OUTER"&&e.indexOf(t)===0})},g.prototype._parse_sort_order=function(e){var t,n,r;return r=e,R.isString(e)?r={path:e,direction:"ASC"}:R.isArray(e)?(n=e[0],t=e[1],r={path:n,direction:t}):e.path==null&&(n=R.keys(e)[0],t=R.values(e)[0],r={path:n,direction:t}),r.path=this.adjustPath(r.path),r.direction=r.direction.toUpperCase(),r},g.prototype.addOrSetSortOrder=function(e){var t,n,r,i,s;e=this._parse_sort_order(e),t=this.getSortDirection(e.path);if(t==null)return this.addSortOrder(e);if(t!==e.direction){s=this.sortOrder;for(r=0,i=s.length;r<i;r++)n=s[r],n.path===e.path&&(n.direction=e.direction);return this.trigger("change:sortorder",this.sortOrder)}},g.prototype.addSortOrder=function(e){return this.sortOrder.push(this._parse_sort_order(e)),this.trigger("add:sortorder",e),this.trigger("change:sortorder",this.sortOrder)},g.prototype.orderBy=function(e){var t,n,r;this.sortOrder=[];for(n=0,r=e.length;n<r;n++)t=e[n],this.addSortOrder(this._parse_sort_order(t));return this.trigger("set:sortorder",this.sortOrder)},g.prototype.addJoins=function(e){var t,n,r,i,s,o,u;if(R.isArray(e)){o=[];for(i=0,s=e.length;i<s;i++)t=e[i],o.push(this.addJoin(t));return o}u=[];for(n in e)r=e[n],u.push(this.addJoin({path:n,style:r}));return u},g.prototype.addJoin=function(e){var t,n,r;R.isString(e)&&(e={path:e,style:"OUTER"}),e.path=this.adjustPath(e.path),e.style=(t=(n=e.style)!=null?n.toUpperCase():void 0)!=null?t:e.style;if(r=e.style,Y.call(g.JOIN_STYLES,r)<0)throw new Error("Invalid join style: "+e.style);return this.joins[e.path]=e.style,this.trigger("set:join",e.path,e.style)},g.prototype.setJoinStyle=function(e,t){return t==null&&(t="OUTER"),e=this.adjustPath(e),t=t.toUpperCase(),this.joins[e]!==t&&(this.joins[e]=t,this.trigger("change:joins",{path:e,style:t})),this},g.prototype.addConstraints=function(e){var t,n,r,i,s,o,u=this;this.__silent__=!0;if(R.isArray(e))for(s=0,o=e.length;s<o;s++)t=e[s],this.addConstraint(t);else{i=function(e,t){return u.addConstraint(k(e,t))};for(r in e)n=e[r],i(r,n)}return this.__silent__=!1,this.trigger("add:constraint"),this.trigger("change:constraints")},g.prototype.addConstraint=function(e){R.isArray(e)?e=C(e):e=d(e),e.path=this.adjustPath(e.path);if(e.type==null)try{e.op=E(e.op)}catch(t){throw new Error("Illegal operator: "+e.op)}return this.constraints.push(e),this.constraintLogic!=null&&this.constraintLogic!==""&&(this.constraintLogic="("+this.constraintLogic+") and "+n[this.constraints.length]),this.__silent__||(this.trigger("add:constraint",e),this.trigger("change:constraints")),this},g.prototype.getSorting=function(){var e;return function(){var t,n,r,i;r=this.sortOrder,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(""+e.path+" "+e.direction);return i}.call(this).join(" ")},g.prototype.getConstraintXML=function(){return this.constraints.length?p(l)(p(x)(H(function(e){return e.type!=null})(this.constraints))):""},g.prototype.getJoinXML=function(){var e,t,n;return n=function(){var n,r;n=this.joins,r=[];for(e in n)t=n[e],this.isInQuery(e)&&t==="OUTER"&&r.push('<join path="'+e+'" style="OUTER"/>');return r}.call(this),n.join("")},g.prototype.toXML=function(){var e,t,n,r;return e={model:this.model.name,view:this.views.join(" "),sortOrder:this.getSorting(),constraintLogic:this.constraintLogic},this.name!=null&&(e.name=this.name),t=function(){var t;t=[];for(n in e)r=e[n],r&&t.push(n+'="'+r+'"');return t}().join(" "),"<query "+t+" >"+this.getJoinXML()+this.getConstraintXML()+"</query>"},g.prototype.toJSON=function(){var e,t,n,r,i;return _({name:this.name,title:this.title,comment:this.comment,description:this.description,constraintLogic:this.constraintLogic,from:this.root,select:function(){var e,t,n,r;n=this.views,r=[];for(e=0,t=n.length;e<t;e++)i=n[e],r.push(S(i));return r}.call(this),orderBy:function(){var e,r,i,s,o;i=this.sortOrder,o=[];for(e=0,r=i.length;e<r;e++)s=i[e],n=s.path,t=s.direction,o.push({path:S(n),direction:t});return o}.call(this),joins:function(){var e,t;e=this.joins,t=[];for(n in e)r=e[n],r==="OUTER"&&t.push(S(n));return t}.call(this),where:function(){var t,n,r,i;r=this.constraints,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(c(e));return i}.call(this)})},g.prototype.fetchCode=function(e,t){var n;return n={query:this.toXML(),lang:e},this.service.post("query/code",n).pipe(this.service.VERIFIER).pipe(w("code")).done(t)},g.prototype.save=function(e,t){var n,r=this;return e!=null&&(this.name=e),n={data:this.toXML(),contentType:"application/xml; charset=UTF-8",url:this.service.root+"query",type:"POST",dataType:"json"},this.service.doReq(n).pipe(this.service.VERIFIER).pipe(w("name")).done(t,function(e){return r.name=e})},g.prototype.getCodeURI=function(e){var t,n;return t={query:this.toXML(),lang:e,format:"text"},((n=this.service)!=null?n.token:void 0)!=null&&(t.token=this.service.token),""+this.service.root+"query/code?"+I(t)},g.prototype.getExportURI=function(e){var t,n;return e==null&&(e="tab"),Y.call(g.BIO_FORMATS,e)>=0?this["get"+e.toUpperCase()+"URI"]():(t={query:this.toXML(),format:e},((n=this.service)!=null?n.token:void 0)!=null&&(t.token=this.service.token),""+this.service.root+"query/results?"+I(t))},g.prototype.fetchQID=function(e){return this.service.post("queries",{query:this.toXML()}).then(function(e){return e.id}).done(e)},e=function(e){return e.append("primaryIdentifier").toString()},g.prototype.__bio_req=function(t,n){var r,i;return i=this.makeListQuery(),r=function(e){return R.any(t,function(t){return e.isa(t)})},i.views=F(n)(function(){var t,i,s,o;s=this.getViewNodes(),o=[];for(t=0,i=s.length;t<i;t++)n=s[t],r(n)&&o.push(e(n));return o}.call(this)),{query:i.toXML(),format:"text"}},g.prototype._fasta_req=function(){return this.__bio_req(["SequenceFeature","Protein"],1)},g.prototype._gff3_req=function(){return this.__bio_req(["SequenceFeature"])},g.prototype._bed_req=g.prototype._gff3_req,g}(),o.ATTRIBUTE_OPS=R.union(o.ATTRIBUTE_VALUE_OPS,o.MULTIVALUE_OPS,o.NULL_OPS),o.REFERENCE_OPS=R.union(o.TERNARY_OPS,o.LOOP_OPS,o.LIST_OPS),G=o.BIO_FORMATS,z=function(e){var t,n,r;return n="_"+e+"_req",t="get"+e.toUpperCase(),r=t+"URI",o.prototype[t]=function(t,r){var i,s,o;return t==null&&(t={}),r==null&&(r=function(){}),R.isFunction(t)&&(o=[{},t],t=o[0],r=o[1]),(t!=null?t.view:void 0)!=null&&(t.view=function(){var e,n,r,i;r=t.view,i=[];for(e=0,n=r.length;e<n;e++)s=r[e],i.push(this.getPathInfo(s).toString());return i}.call(this)),i=R.extend(this[n](),t),this.service.post("query/results/"+e,i).done(r)},o.prototype[r]=function(t,r){var i,s,o;return t==null&&(t={}),R.isFunction(t)&&(o=[{},t],t=o[0],r=o[1]),(t!=null?t.view:void 0)!=null&&(t.view=function(){var e,n,r,i;r=t.view,i=[];for(e=0,n=r.length;e<n;e++)s=r[e],i.push(this.getPathInfo(s).toString());return i}.call(this)),i=R.extend(this[n](),t),this.service.token!=null&&(i.token=this.service.token),""+this.service.root+"query/results/"+e+"?"+I(i)}};for(X=0,$=G.length;X<$;X++)g=G[X],z(g);W=function(e){return function(){var t,n,r,i;n=arguments[0],t=2<=arguments.length?et.call(arguments,1):[];if(this.service[e])return n==null?n={}:R.isFunction(n)&&(n={},t=function(){var e,t,n;n=[];for(e=0,t=arguments.length;e<t;e++)r=arguments[e],n.push(r);return n}.apply(this,arguments)),R.defaults(n,{start:this.start,size:this.maxRows}),(i=this.service)[e].apply(i,[this,n].concat(et.call(t)));throw new Error("Service does not provide '"+e+"'.")}};for(V=0,J=u.length;V<J;V++)O=u[V],o.prototype[O]=W(O);N.Query=o}.call(this),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt=function(e,t){return function(){return e.apply(t,arguments)}},nt=[].slice;f=typeof exports!="undefined",Z=typeof exports!="undefined"&&exports!==null?exports:this,f?(Y=require("underscore")._,r=(e=require("underscore.deferred")).Deferred,m=require("./model").Model,E=require("./query").Query,p=require("./lists").List,M=require("./user").User,a=require("./id-resolution-job").IDResolutionJob,q=require("./util"),G=require("querystring").stringify,z=require("./http"),W=exports):(Y=Z._,V=Z.jQuery,W=Z.intermine,r=(e=V).Deferred,G=function(e){return V.param(e,!0)},m=W.Model,E=W.Query,p=W.List,M=W.User,a=W.IDResolutionJob,q=W.funcutils,z=W.http),J=q.pairsToObj,$=q.omap,R=q.get,K=q.set,X=q.invoke,Q=q.success,I=q.error,S=q.REQUIRES_VERSION,F=q.dejoin,_={},d={},C={},H={},n="http://",D="version",A="templates",l="lists",v="model",N="summaryfields",b="query/results",w="search",B="widgets",i="list/enrichment",j="listswithobject",c={union:"lists/union",intersection:"lists/intersect",difference:"lists/diff"},x="lists/subtract",P="user/whoami",L=b+"/tablerows",y="user/preferences",g="path/values",u=function(e){return e},s=/^https?:\/\//i,o=/service\/?$/i,T="/service/",t=function(e){var t,n;if(f&&e.stack!=null)return console.error(e.stack);t=(e!=null?e.stack:void 0)?[e.stack]:arguments;if(typeof console!="undefined"&&console!==null)return(n=console.error||console.log)!=null?n.apply(console,t):void 0},et=function(e,t,n,r,i){var s,o,u,a=this;return s=(u=this[e])!=null?u:this[e]=this.useCache&&(o=t[this.root])?Q(o):this.get(n).pipe(R(r)).done(function(e){return t[a.root]=e}),s.done(i)},U=function(e){return function(t){return r(function(){var n;return(n=Y.find(t,function(t){return t.name===e}))?this.resolve(n):this.reject('List "'+e+'" not found among: '+t.map(R("name")))})}},h=function(e,t){return t==null&&(t="listName"),Y.compose(e.fetchList,R(t))},O=function(e){var t,n,r,i,s,o;e==null&&(e=[]),i=Y.isArray(e)?e:[e],o=[];for(n=0,r=i.length;n<r;n++)t=i[n],o.push((s=t.name)!=null?s:t);return o},k=function(){function k(e){var r,i,u,a,l=this;this.root=e.root,this.token=e.token,this.errorHandler=e.errorHandler,this.DEBUG=e.DEBUG,this.help=e.help,i=e.noCache,this.createList=tt(this.createList,this),this.resolveIds=tt(this.resolveIds,this),this.query=tt(this.query,this),this.fetchWidgetMap=tt(this.fetchWidgetMap,this),this.fetchWidgets=tt(this.fetchWidgets,this),this.complement=tt(this.complement,this),this.fetchListsContaining=tt(this.fetchListsContaining,this),this.fetchList=tt(this.fetchList,this),this.findLists=tt(this.findLists,this),this.fetchLists=tt(this.fetchLists,this),this.fetchTemplates=tt(this.fetchTemplates,this),this.tableRows=tt(this.tableRows,this),this.rows=tt(this.rows,this),this.records=tt(this.records,this),this.table=tt(this.table,this),this.pathValues=tt(this.pathValues,this),this.values=tt(this.values,this),this.fetchUser=tt(this.fetchUser,this),this.whoami=tt(this.whoami,this),this.findById=tt(this.findById,this),this.count=tt(this.count,this),this.enrichment=tt(this.enrichment,this);if(this.root==null)throw new Error("No service root provided. This is required");s.test(this.root)||(this.root=n+this.root),o.test(this.root)||(this.root=this.root+T),this.root=this.root.replace(/ice$/,"ice/"),(u=this.errorHandler)==null&&(this.errorHandler=t),(a=this.help)==null&&(this.help="no.help.available@dev.null"),this.useCache=!i,r=f?"":location.protocol+"//"+location.host,this.getFormat=function(e){return e==null&&(e="json"),!/jsonp/.test(e)&&!f&&!V.support.cors&&r.substring(0,l.root.length)!==l.root?e.replace("json","jsonp"):e}}var u;return k.prototype.post=function(e,t){return t==null&&(t={}),this.makeRequest("POST",e,t)},k.prototype.get=function(e,t){return this.makeRequest("GET",e,t)},k.prototype.makeRequest=function(e,t,n,r,i){var s,o,u,a,f,l;return e==null&&(e="GET"),t==null&&(t=""),n==null&&(n={}),r==null&&(r=function(){}),i==null&&(i=!1),Y.isArray(r)&&(f=r,r=f[0],o=f[1]),Y.isArray(n)&&(n=J(n)),a=this.root+t,o==null&&(o=this.errorHandler),this.token&&(n.token=this.token),n.format=this.getFormat(n.format),/jsonp/.test(n.format)&&(n.method=e,e="GET",a+="?callback=?"),s=/json/.test(n.format)?"json":"text",z.supports(e)||(l=[e,z.getMethod(e)],n.method=l[0],e=l[1]),e==="DELETE"&&(a+="?"+G(n)),u={data:n,dataType:s,success:r,error:o,url:a,type:e},z.doReq(u,i)},k.prototype.enrichment=function(e,t){var n=this;return S(this,8,function(){return n.get(i,Y.defaults({},e,{maxp:.05,correction:"Holm-Bonferroni"})).pipe(R("results")).done(t)})},k.prototype.search=function(e,t){var n=this;return e==null&&(e={}),t==null&&(t=function(){}),S(this,9,function(){var r,i,s,o,u,a;Y.isFunction(e)&&(u=[e,{}],t=u[0],e=u[1]),Y.isString(e)&&(e={q:e}),s=Y.defaults({},e,{q:""}),delete s.facets;if(e.facets){a=e.facets;for(r in a)o=a[r],s["facet_"+r]=o}return i=function(e){return Q(e.results,e.facets)},n.post(w,s).pipe(i).done(t)})},k.prototype.count=function(e,t){var n,r;return t==null&&(t=function(){}),e?e.toPathString!=null?(n=e.isClass()?e.append("id"):e,this.pathValues(n,"count").done(t)):e.toXML!=null?(r={query:e.toXML(),format:"jsoncount"},this.post(b,r).pipe(R("count")).done(t)):Y.isString(e)?this.fetchModel().pipe(X("makePath",e.replace(/\.\*$/,".id"))).pipe(this.count).done(t):this.query(e).pipe(this.count).done(t):I("Not enough arguments")},k.prototype.findById=function(e,t,n){return this.query({from:e,select:["**"],where:{id:t}}).pipe(F).pipe(X("records")).pipe(R(0)).done(n)},k.prototype.find=function(e,t,n){return this.query({from:e,select:["**"],where:[[e,"LOOKUP",t]]}).pipe(F).pipe(X("records")).done(n)},k.prototype.whoami=function(e){var t=this;return S(this,9,function(){return t.get(P).pipe(R("user")).pipe(function(e){return new M(t,e)}).done(e)})},k.prototype.fetchUser=function(){var e;return e=1<=arguments.length?nt.call(arguments,0):[],this.whoami.apply(this,e)},k.prototype.values=function(e,t,n){var r=this;return t==null&&(t={}),n==null&&(n=function(){}),S(this,6,function(){try{return r.fetchModel().pipe(X("makePath",e,e.subclasses||t)).pipe(r.pathValues).done(n)}catch(i){return I(i)}})},k.prototype.pathValues=function(e,t){var n,r;return t!=="count"&&(t="results"),n=t==="count"?"jsoncount":"json",r={format:n,path:e.toString(),typeConstraints:JSON.stringify(e.subclasses)},this.post(g,r).pipe(R(t))},k.prototype.doPagedRequest=function(e,t,n,r,i){var s,o=this;return n==null&&(n={}),e.toXML!=null?(s=Y.defaults({},{query:e.toXML(),format:r},n),this.post(t,s).pipe(function(e){return Q(e.results,e)}).done(i)):this.query(e).pipe(function(e){return o.doPagedRequest(e,t,n,r,i)})},k.prototype.table=function(e,t,n){return this.doPagedRequest(e,b,t,"jsontable",n)},k.prototype.records=function(e,t,n){return this.doPagedRequest(e,b,t,"jsonobjects",n)},k.prototype.rows=function(e,t,n){return this.doPagedRequest(e,b,t,"json",n)},k.prototype.tableRows=function(e,t,n){return this.doPagedRequest(e,L,t,"json",n)},k.prototype.fetchTemplates=function(e){return this.get(A).pipe(R("templates")).done(e)},k.prototype.fetchLists=function(e){return this.findLists("",e)},k.prototype.findLists=function(e,t){var n=this;return e==null&&(e=""),t==null&&(t=function(){}),this.fetchVersion().pipe(function(r){var i;return e&&r<13?I("Finding lists by name on the server requires version 13. This is only "+r):(i=function(e){var t,r,i,s;s=[];for(r=0,i=e.length;r<i;r++)t=e[r],s.push(new p(t,n));return s},n.get(l,{name:e}).pipe(R("lists")).pipe(i).done(t))})},k.prototype.fetchList=function(e,t){var n=this;return this.fetchVersion().pipe(function(r){return r<13?n.findLists().pipe(U(e)).done(t):n.findLists(e).pipe(R(0)).done(t)})},k.prototype.fetchListsContaining=function(e,t){var n,r=this;return n=function(e){var t,n,i,s;s=[];for(n=0,i=e.length;n<i;n++)t=e[n],s.push(new p(t,r));return s},this.get(j,e).pipe(R("lists")).pipe(n).done(t)},k.prototype.combineLists=function(e,t,n){var r,i;return r=Y.pick(t,"name","description"),(i=r.description)==null&&(r.description=""+e+" of "+t.lists.join(", ")),r.tags=(t.tags||[]).join(";"),r.lists=(t.lists||[]).join(";"),this.get(c[e],r).pipe(h(this)).done(n)},k.prototype.merge=function(){return this.combineLists.apply(this,["union"].concat(nt.call(arguments)))},k.prototype.intersect=function(){return this.combineLists.apply(this,["intersection"].concat(nt.call(arguments)))},k.prototype.diff=function(){return this.combineLists.apply(this,["difference"].concat(nt.call(arguments)))},k.prototype.complement=function(e,t){var n,r,i,s,o,u,a,f,l;return e==null&&(e={}),t==null&&(t=function(){}),s=e.from,i=e.exclude,u=e.name,r=e.description,l=e.tags,n=function(){return"Relative complement of "+o.join(" and ")+" in "+a.join(" and ")},a=O(s),o=O(i),u==null&&(u=n()),r==null&&(r=n()),l==null&&(l=[]),f={name:u,description:r,tags:l,lists:o,references:a},this.post(x,f).pipe(h(this)).done(t)},k.prototype.fetchWidgets=function(e){var t=this;return S(this,8,function(){return et.call(t,"widgets",H,B,"widgets",e)})},u=$(function(e){return[e.name,e]}),k.prototype.fetchWidgetMap=function(e){var t=this;return S(this,8,function(){var n;return((n=t.__wmap__)!=null?n:t.__wmap__=t.fetchWidgets().then(u)).done(e)})},k.prototype.fetchModel=function(e){return et.call(this,"model",d,v,"model").pipe(m.load).pipe(K({service:this})).done(e)},k.prototype.fetchSummaryFields=function(e){return et.call(this,"summaryFields",C,N,"classes",e)},k.prototype.fetchVersion=function(e){return et.call(this,"version",_,D,"version",e)},k.prototype.query=function(t,n){var i=this;return e.when(this.fetchModel(),this.fetchSummaryFields()).pipe(function(e,s){var o,u;return o=Y.extend({},t,{model:e,summaryFields:s}),u=i,r(function(){this.fail(u.errorHandler),this.done(n);try{return this.resolve(new E(o,u))}catch(e){return this.reject(e)}})})},k.prototype.manageUserPreferences=function(e,t){var n=this;return S(this,11,function(){return n.makeRequest(e,y,t).pipe(R("preferences"))})},k.prototype.resolveIds=function(e,t){var n=this;return S(this,10,function(){var r;return r={data:JSON.stringify(e),dataType:"json",url:n.root+"ids",type:"POST",contentType:"application/json"},z.doReq(r).pipe(R("uid")).pipe(a.create(n)).done(t)})},k.prototype.createList=function(e,t,n){var r,i,s=this;return e==null&&(e={}),t==null&&(t=""),n==null&&(n=function(){}),r=function(t){return Y.defaults({token:s.token,tags:e.tags||[]},t)},i={data:Y.isArray(t)?t.map(function(e){return'"'+e+'"'}).join("\n"):t,dataType:"json",url:""+this.root+"lists?"+G(r(e)),type:"POST",contentType:"text/plain"},z.doReq(i).pipe(h(this)).done(n)},k}(),k.prototype.rowByRow=z.iterReq("POST",b,"json"),k.prototype.eachRow=k.prototype.rowByRow,k.prototype.recordByRecord=z.iterReq("POST",b,"jsonobjects"),k.prototype.eachRecord=k.prototype.recordByRecord,k.prototype.union=k.prototype.merge,k.prototype.difference=k.prototype.diff,k.prototype.symmetricDifference=k.prototype.diff,k.prototype.relativeComplement=k.prototype.complement,k.prototype.subtract=k.prototype.complement,k.flushCaches=function(){return d={},_={},C={},H={}},k.connect=function(e){return e==null&&(e={}),new k(e)},W.Service=k}.call(this);